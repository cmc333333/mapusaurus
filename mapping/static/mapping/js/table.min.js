function getTableData(reportName) {
    return $("#tableLoadImage").show(), $.ajax({
        url: "/reports/" + reportName + "/",
        data: {
            county: urlParam("county") || "",
            lender: urlParam("lender") || "",
            metro: urlParam("metro") || "",
            year: urlParam("year") || ""
        },
        traditional: !0
    }).fail(function(response) {
        console.log("Error retrieving data", response.status, response.responseText);
    });
}

function createTable(reportName) {
    getTableData(reportName).done(function(res) {
        var $tbl = buildTable(res);
        $("#tableLoadImage").hide(), $tbl.appendTo($("#table-container")).show(), activateTable($tbl), 
        $("#closeTable").on("click", function() {
            toggleDataContainer(!1), currentChart = "undefined", $(".chart-toggle").removeClass("active-layer");
        }), generateTooltips("#table-container", [ 0, -1 ]);
    });
}

function buildTable(tableData) {
    return _.each(tableData.data, function(row) {
        _.each(tableData.fields, function(fieldName) {
            var value = row[fieldName];
            _.isNumber(value) && (row[fieldName] = row[fieldName].toLocaleString());
        });
    }), $(reportTemplate({
        fieldNames: tableData.fields,
        rows: tableData.data
    }));
}

function activateTable($tbl) {
    return $tbl.tablesorter({
        headerTemplate: "",
        widgets: [ "stickyHeaders" ],
        widgetOptions: {
            stickyHeaders_attachTo: "#data-container"
        }
    });
}

function destroyData() {
    destroyTable(), $("#table-container").hide(), setMapHeight();
}

function destroyTable() {
    $(".summary-data-table").trigger("destroy").remove(), setMapHeight();
}

function toggleDataContainer(showData) {
    showDataContainer = showData, showData ? ($("#data-container").show(), $("#data-container-sizer").show()) : ($("#data-container").hide(), 
    $("#data-container-sizer").hide()), setMapHeight();
}

var reportTemplate, currentChart;

$(document).ready(function() {
    _.templateSettings.variable = "data", reportTemplate = _.template($("script.report-template").html()), 
    $(".chart-toggle").click(function(e) {
        var $target = $(e.target).closest(".chart-toggle"), id = $target.attr("id") || "";
        $(".chart-toggle").removeClass("active-layer"), $target.addClass("active-layer"), 
        currentChart && destroyData(), currentChart != id ? (createTable(id.substr("chart-toggle__".length)), 
        $("#table-container").show(), currentChart = id, toggleDataContainer(!0)) : (currentChart = null, 
        toggleDataContainer(!1), $(".chart-toggle").removeClass("active-layer"));
    });
});
//# sourceMappingURL=table.min.js.map